<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>${root.Details.Title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- –¢–≤–æ–π CSS -->
    <link href="styles.css" rel="stylesheet">
    <link rel="stylesheet" href="/sem/css/product.css">
</head>
<body class="product-page">

<header class="site-header">
    <div class="brand">Loire Valley</div>

    <div class="search">
        <input type="text" placeholder="Search experiences in Loire Valley">
    </div>

    <nav class="top-links">
        <a href="/tours">Tours</a>
        <a href="/search">Search</a>
        <a href="/about">About</a>
        <a href="/help">Help</a>
    </nav>
</header>

<div class="container">

    <!-- BREADCRUMBS -->
    <nav class="breadcrumbs">
        <a href="/">Home</a>
        <span class="sep">/</span>
        <a href="/tours">Tours</a>
        <span class="sep">/</span>
        <a href="/tours?city=${root.Details.City}">${root.Details.City}</a>
        <span class="sep">/</span>
        <span>${root.Details.Category}</span>
    </nav>

</div>

<!-- HERO -->
<div class="hero">
    <div class="hero-frame">
        $if(!string.IsNullOrEmpty(root.Details.Hero))
        <img src="${root.Details.Hero}" alt="${root.Details.Title}">
        $else
        <img src="/sem/img/hero-placeholder.jpg" alt="${root.Details.Title}">
        $endif
        <button class="photos-btn">View all photos</button>
    </div>
</div>

<div class="container">
    <div class="grid">

        <!-- LEFT COLUMN -->
        <main>

            <!-- Category pill + title -->
            <div class="category-pill">${root.Details.Category}</div>

            <h1 class="title">${root.Details.Title}</h1>

            <!-- Rating block -->
            <div class="rating">
                <div class="badge">
                    ${root.Details.Rating}
                </div>
                <div id="score-text">${root.Details.RatingText}</div>
                <a href="#reviews">Based on ${root.Details.Reviews} reviews</a>
            </div>

            <!-- Meta info -->
            <div class="meta">
                <div class="meta-item">
                    <span>‚è±</span>
                    <div>
                        <div><b>Duration</b></div>
                        <div>${root.Details.Duration}</div>
                    </div>
                </div>
                <div class="meta-item">
                    <span>üéß</span>
                    <div>
                        <div><b>Language</b></div>
                        <div>${root.Details.Languages}</div>
                    </div>
                </div>
                <div class="meta-item">
                    <span>üì±</span>
                    <div>
                        <div><b>Mobile voucher</b></div>
                        <div>Instant confirmation</div>
                    </div>
                </div>
            </div>

            <!-- Chips -->
            <div class="chips">
                $foreach(var chip in root.Details.Chips)
                <div class="chip">
                    <span>‚úî</span>
                    <span>${chip}</span>
                </div>
                $endfor
            </div>

            <!-- Why you'll love this -->
            <section>
                <h2>Why you‚Äôll love this</h2>
                <ul class="list">
                    $foreach(var it in root.Details.Love)
                    <li>${it}</li>
                    $endfor
                </ul>
            </section>

            <!-- What to expect / description -->
            $if(!string.IsNullOrEmpty(root.Details.DescriptionHtml))
            <section class="expect">
                <h2>What to expect</h2>
                <div class="read-more faded" id="desc-box">
                    ${root.Details.DescriptionHtml}
                </div>
                <button class="read-toggle" id="read-toggle" type="button">Read more</button>
            </section>
            $endif

            <!-- Included -->
            <section>
                <h2>What‚Äôs included</h2>
                <ul class="list included">
                    $foreach(var inc in root.Details.Included)
                    <li>${inc}</li>
                    $endfor
                </ul>
            </section>

            <!-- What to remember -->
            <section>
                <h2>What to remember</h2>
                <ul class="list">
                    $foreach(var r in root.Details.Remember)
                    <li>${r}</li>
                    $endfor
                </ul>
            </section>

            <!-- Meeting point & map -->
            $if(!string.IsNullOrEmpty(root.Details.Meeting) || !string.IsNullOrEmpty(root.Details.Address))
            <section>
                <h2>Meeting point</h2>
                $if(!string.IsNullOrEmpty(root.Details.Meeting))
                <p>${root.Details.Meeting}</p>
                $endif
                $if(!string.IsNullOrEmpty(root.Details.Address))
                <p>${root.Details.Address}</p>
                $endif

                <div class="map">
                    <!-- –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π map –∏–ª–∏ iframe -->
                    <img src="/sem/img/map-placeholder.png" alt="Meeting point map">
                </div>
            </section>
            $endif

            <!-- Cancellation policy -->
            $if(!string.IsNullOrEmpty(root.Details.CancelPolicy))
            <section>
                <h2>Cancellation policy</h2>
                <p>${root.Details.CancelPolicy}</p>
            </section>
            $endif

            <!-- Reviews -->
            <section id="reviews">
                <h2>Reviews</h2>
                <div class="reviews-grid">
                    <div>
                        <div class="score-big">${root.Details.Rating}</div>
                        <p class="muted">
                            Based on <b>${root.Details.Reviews}</b> verified reviews
                        </p>
                        <!-- –ü—Ä–∏–º–µ—Ä —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–æ—Å–æ–∫, –º–æ–∂–Ω–æ –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å/–ø–æ—Å—á–∏—Ç–∞—Ç—å -->
                        <div>
                            <div>Excellent</div>
                            <div class="bar"><span style="width: 86%"></span></div>
                        </div>
                        <div>
                            <div>Very good</div>
                            <div class="bar"><span style="width: 10%"></span></div>
                        </div>
                    </div>
                    <div>
                        $if(root.Reviews != null && root.Reviews.Any())
                        $foreach(var rv in root.Reviews)
                        <div class="book-row" style="border-top:none; padding:10px 0;">
                            <div>
                                <b>${rv.Author}</b>
                                <div class="muted" style="font-size:12px;">
                                    ${rv.CreatedAt.ToString("dd MMM yyyy")} ‚Ä¢ ${rv.Rating}/5
                                </div>
                                <p style="margin:4px 0 0; font-size:14px;">
                                    ${rv.Comment}
                                </p>
                            </div>
                        </div>
                        $endfor
                        $else
                        <p class="muted">No reviews yet. Be the first to share your experience.</p>
                        $endif
                    </div>
                </div>
            </section>

        </main>

        <!-- RIGHT COLUMN / BOOKING CARD -->
        <aside class="book-card">

            <h3>Book your ticket</h3>
            <div class="best">
                <span>‚òÖ Best choice</span>
            </div>

            <p class="muted">
                From <b>${root.Details.Price}</b> per person
            </p>

            <div class="ticket-box">
                <div class="ticket">Standard ticket</div>

                <div class="book-row">
                    <div>
                        <div class="muted">Instant confirmation</div>
                        <div class="muted">Mobile ticket accepted</div>
                    </div>
                    <div class="price-blue">
                        ${root.Details.Price}
                    </div>
                </div>

                <div class="book-row">
                    <div class="muted">Select quantity</div>
                    <div class="qty">
                        <button type="button" id="minus">-</button>
                        <span id="qty">1</span>
                        <button type="button" id="plus">+</button>
                    </div>
                </div>

                <div class="book-row total-row">
                    <div class="muted">Total</div>
                    <div class="total blue" id="total-price">
                        ${root.Details.Price}
                    </div>
                </div>
            </div>

            <div class="cta">
                <button type="button" id="check-btn">Check availability</button>
                <button type="button">Book now</button>
            </div>

            <p class="muted" style="margin-top:10px; font-size:12px;">
                Free cancellation according to the policy. No extra fees.
            </p>
        </aside>

    </div>
</div>

<!-- YOU MIGHT ALSO LIKE -->
<section class="more">
    <div class="container">
        <h2>You might also like</h2>
        <div class="cards">
            $foreach(var m in root.RelatedTours)
            <a href="/product?slug=${m.Slug}" class="card">
                <div class="img-wrap">
                    $if(!string.IsNullOrEmpty(m.HeroUrl))
                    <img src="${m.HeroUrl}" alt="${m.Title}">
                    $else
                    <img src="/sem/img/card-placeholder.jpg" alt="${m.Title}">
                    $endif
                    <div class="tag">${m.City}</div>
                </div>
                <div class="body">
                    <div class="muted" style="font-size:12px;">${m.CategoryName}</div>
                    <div><b>${m.Title}</b></div>
                </div>
                <div class="price">From ${m.PriceFrom}</div>
            </a>
            $endfor

            $if(root.RelatedTours == null || !root.RelatedTours.Any())
            <div class="card">
                <div class="body">
                    <div><b>More Loire Valley experiences coming soon</b></div>
                    <p class="muted">Stay tuned for new tours and activities.</p>
                </div>
            </div>
            $endif
        </div>
    </div>
</section>

<!-- JS: qty + total + read-more + AJAX-–∑–∞–≥–æ—Ç–æ–≤–∫–∞ -->
<script>
    (function () {
        // qty & total
        var price = parseFloat("${root.Details.Price}".replace(",", "."));
        if (isNaN(price)) price = 0;

        var qtyEl = document.getElementById("qty");
        var totalEl = document.getElementById("total-price");
        var plus = document.getElementById("plus");
        var minus = document.getElementById("minus");

        function updateTotal() {
            var q = parseInt(qtyEl.textContent || "1", 10);
            if (!q || q < 1) q = 1;
            qtyEl.textContent = q;
            if (totalEl) {
                totalEl.textContent = (price * q).toFixed(2);
            }
        }

        if (plus) plus.onclick = function () {
            var q = parseInt(qtyEl.textContent || "1", 10) + 1;
            qtyEl.textContent = q;
            updateTotal();
        };

        if (minus) minus.onclick = function () {
            var q = parseInt(qtyEl.textContent || "1", 10) - 1;
            if (q < 1) q = 1;
            qtyEl.textContent = q;
            updateTotal();
        };

        updateTotal();

        // Read more
        var box = document.getElementById("desc-box");
        var toggle = document.getElementById("read-toggle");
        if (box && toggle) {
            toggle.addEventListener("click", function () {
                box.classList.toggle("faded");
                if (box.style.maxHeight) {
                    box.style.maxHeight = "";
                    toggle.textContent = "Read more";
                } else {
                    box.style.maxHeight = "none";
                    toggle.textContent = "Show less";
                }
            });
        }

        // AJAX check availability (–º–∏–Ω–∏–º—É–º –¥–ª—è –¢–ó)
        var checkBtn = document.getElementById("check-btn");
        if (checkBtn) {
            checkBtn.addEventListener("click", function () {
                var experienceId = "${root.Experience.Id}";
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "/api/check-availability?experienceId=" + encodeURIComponent(experienceId));
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            alert("Dates are available for your selection.");
                        } else {
                            alert("Unable to check availability. Please try again.");
                        }
                    }
                };
                xhr.send();
            });
        }
    })();
</script>

</body>
</html>
